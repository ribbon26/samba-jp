<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [
				  
<!ENTITY % globalentities SYSTEM '../global.ent'> %globalentities;
]>
<refentry id="smbd.8">

<refmeta>
	<refentrytitle>smbd</refentrytitle>
	<manvolnum>8</manvolnum>
</refmeta>


<refnamediv>
	<refname>smbd</refname>
	<refpurpose>SMB/CIFS サービスをクライアントへ提供するサーバ</refpurpose>
</refnamediv>

<refsynopsisdiv>
	<cmdsynopsis>
		<command>smbd</command>
		<arg choice="opt">-D</arg>
		<arg choice="opt">-F</arg>
		<arg choice="opt">-S</arg>
		<arg choice="opt">-i</arg>
		<arg choice="opt">-h</arg>
		<arg choice="opt">-V</arg>
		<arg choice="opt">-b</arg>
		<arg choice="opt">-d &lt;debug level&gt;</arg>
		<arg choice="opt">-l &lt;log directory&gt;</arg>
		<arg choice="opt">-p &lt;port number&gt;</arg>
		<arg choice="opt">-O &lt;socket option&gt;</arg>
		<arg choice="opt">-s &lt;configuration file&gt;</arg>
	</cmdsynopsis>
</refsynopsisdiv>

<refsect1>
	<title>解説</title>
	<para>このプログラムは <citerefentry><refentrytitle>Samba</refentrytitle>
	<manvolnum>7</manvolnum></citerefentry> スイートの一部である。</para>

	<para><command>smbd</command> は、Windows クライアントにファイル共有と印刷サービスを提供するサーバデーモンである。
	サーバは SMB (または CIFS) プロトコルを使用するクライアントに
	ファイル・スペースと印刷サービスを提供する。サーバは 
	LanManager プロトコルと互換性があり、LanManager クライアントに
	対するサービスが可能である。クライアントには MSCLIENT 3.0 for 
	DOS、Windows for Workgroups、Windows 95/98/Me、Windows 2000、
	Windows NT、OS/2、DAVE for Macintosh、smbfs for Linux が含まれる。</para>

	<para>サーバが提供できるサービスについての詳細な記述は、
	それらサービスの属性を制御する設定ファイルの
	マニュアルページにある
	(<citerefentry><refentrytitle>smb.conf</refentrytitle>
	<manvolnum>5</manvolnum></citerefentry>を参照)。このマニュアルページでは
	サービスについて記述せず、サーバを動作させる上での
	管理の面にしぼって記述する。</para>

	<para>このサーバを動作させることは
	重要なセキュリティーとの関係があること、そして <citerefentry><refentrytitle>smb.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>
	のマニュアルページはインストールを進める前に
	必ず読むべきものであることに注意すること。</para>

	<para>セッションはクライアントに要求されるたびに作られる。
	各クライアントは各セッション毎にサーバプロセスのコピーを得る。
	このコピーはセッションの間、クライアントによるすべての
	接続を提供する。クライアントのすべての接続が切断されると、
	そのクライアントに対するサーバのコピーは終了する。</para>

	<para>設定ファイルとそれに含まれるファイルが変更されると、
	1分ごとに自動的に再読込される。サーバに SIGHUP を送ることにより
	再読み込みを強制することもできる。設定ファイルの再読込は、
	すでに確立されているサービスの接続には影響しない。
	ユーザがサービスから切断するか、<command>smbd</command>
	を終了して再起動するまで設定ファイルの変更は反映されない。</para>
</refsect1>

<refsect1>
	<title>オプション</title>

	<variablelist>
		<varlistentry>
		<term>-D</term>
		<listitem><para>このパラメータが指定されると、
		サーバはデーモンとして動作することになる。つまり、自身を分離して
		バックグラウンドで走らせ、適切なポートに対する要求を
		処理するようになる。 臨時にファイルおよび印刷サービスを提供する
		サーバとして利用する以外の場合は、サーバをデーモンとして
		起動するのが <command>smbd</command> の起動方法として推奨される。
		<command>smbd</command> がシェルのコマンドラインから
		実行されたときはこのスイッチが指定されたと見なされる。
		</para></listitem>
		</varlistentry>

		<varlistentry>
		<term>-F</term>
		<listitem><para>
		このパラメータを指定すると、
		<command>smbd</command>
		のメインプロセスはデーモン化しなくなる。
		つまり、
		2 回の <command>fork(2)</command> と端末からの切り離しを行なわない。
		通常通り接続要求を処理するための子プロセスが生成されるが、
		メインプロセスは終了しない。
		この動作方式は、
		Daniel J. Bernstein 作の <command>daemontools</command>
		パッケージに含まれる
		<command>supervise</command> と <command>svscan</command>
		や、
		AIX のプロセスモニターなど、プロセス監視の下で
		<command>smbd</command>
		を動作させるのに都合がよい。
		</para></listitem>
		</varlistentry>

		<varlistentry>
		<term>-S</term>
		<listitem><para>このパラメータが指定されると、<command>smbd</command> は
		ファイルではなく標準出力にログを出力する。</para></listitem>
		</varlistentry>

		<varlistentry>
		<term>-i</term>
		<listitem><para>このパラメータが指定されると、
		サーバはコマンドラインでデーモンとして実行されていたとしても
		デーモンではなく、"対話形式"で動作する。
		このパラメータを設定することにより、コマンドラインからの起動により暗黙
		的にデーモンモードとなることを無効にする。
		また、<command>-S</command> パラメータが指定されているかのように、
		<command>smbd</command> は標準出力にログを出力する。
		</para></listitem>
		</varlistentry>
		
		&popt.common.samba;
		&stdarg.help;

		<varlistentry>
		<term>-b</term>
		<listitem><para>どのようにSambaがビルドされたか表示する。
		</para></listitem>
		</varlistentry>
		
		<varlistentry>
		<term>-p &lt;port number&gt;</term>
		<listitem><para><replaceable>port number</replaceable> は
		正の整数値である。このパラメータが指定されていないときの
		デフォルト値は 139 である。</para>
		
		<para>この数字は、クライアント・ソフトウェアからサーバへの
		接続を確立するときに使用されるポート番号である。
		SMB over TCP の標準的な(well-knownな)ポート番号は 139 
		であり、それ故にこれがデフォルト値である。あなたが
		root ではないふつうのユーザでサーバを動作させたいならば、
		多くのシステムでは 1024 より大きいポート番号を
		使わなければならない。- あなたがこの状況にいるかどうかは、
		あなたのシステムの管理者に尋ねるとよい。
		</para>
		
		<para>たいていのクライアントからサーバを
		利用できるようにしたくてもポートを 139 以外に
		構成しなければならないときは、ポート 139 にポート・
		リダイレクト・サービスが必要になる。詳しくは 
		rfc1002.txt の 4.3.5 節に概略が述べられている。</para>
		
		<para>このパラメータは、上記の状況を除いては
		通常指定しない。</para></listitem>
		</varlistentry>
	</variablelist>
</refsect1>

<refsect1>
	<title>関連ファイル</title>

	<variablelist>
		<varlistentry>
		<term><filename>/etc/inetd.conf</filename></term>
		<listitem><para>サーバを
		<command>inetd</command> メタ・デーモンによって動作させるには、このファイルに
		メタ・デーモン用の適切な起動情報を含める必要がある。
		</para></listitem>
		</varlistentry>
		
		<varlistentry>
		<term><filename>/etc/rc</filename></term>
		<listitem><para>(あるいは、あなたのシステムが
		使用する初期化スクリプト)</para>

		<para>システム起動時にデーモンとしてサーバを動作させるなら、
		このファイルにサーバのための適切な起動手続きを
		含める必要がある。</para></listitem>
		</varlistentry>
		
		<varlistentry>
		<term><filename>/etc/services</filename></term>
		<listitem><para> <command>inetd</command> メタ・デーモンを
		介してサーバを動作させるなら、このファイルにサービスポート
		(例:139)とプロトコルタイプ(例:tcp)に対するサービス名
		(例:netbios-ssn)のマッピングを含める必要がある。
		</para></listitem>
		</varlistentry>
		
		<varlistentry>
		<term><filename>/usr/local/samba/lib/smb.conf</filename></term>
		<listitem><para>このファイルはサーバの設定ファイルである <citerefentry><refentrytitle>smb.conf</refentrytitle>
		<manvolnum>5</manvolnum></citerefentry> のデフォルトの位置である。その他、システムがこのファイルをインストール
		しそうな場所としては、 <filename>/usr/samba/lib/smb.conf</filename> 
		や <filename>/etc/samba/smb.conf</filename> がある。</para>
		
		<para>このファイルにはサーバがクライアントから利用できるようにする
		全てのサービスを記述する。さらなる情報は <citerefentry><refentrytitle>smb.conf</refentrytitle>
		<manvolnum>5</manvolnum></citerefentry> を参照のこと。</para>
		</listitem>
		</varlistentry>
	</variablelist>
</refsect1>

<refsect1>
	<title>制限</title>
	<para>いくつかのシステム上において、<command>smbd</command> は
	setuid() を呼び出した後に uid を root に戻すことができない。この種のシステムは、トラップドア uid システムと呼ばれる。
	そのようなシステムの場合、異なる二人のユーザとして (PC のような)
	クライアントから同時に接続を行うことができない。
	二人目のユーザ接続の試みは、「アクセス拒否」
	または類似の結果となる。</para>
</refsect1>

<refsect1>
	<title>環境変数</title>

	<variablelist>
		<varlistentry>
		<term><envar>PRINTER</envar></term>
		<listitem><para>プリント・サービスでプリンタの名前が
		指定されていないとき、多くのシステムでは使用するプリンタ名として、
		この変数の値が(もしくは変数が定義されていないなら<constant>lp</constant> が)利用される。しかしながら
		これはサーバの特性であるという訳ではない。</para></listitem>
		</varlistentry>
	</variablelist>
</refsect1>


<refsect1>
        <title>PAM との相互作用</title>
	<para>Samba はアカウントチェック(アカウントが無効か?)や
	セッション管理のため(平文のパスワードが提供されたときに)
	認証に PAM を使う。samba の PAM をサポートする程度は、
	SMBプロトコルと<citerefentry><refentrytitle>smb.conf</refentrytitle><manvolnum>5</manvolnum></citerefentry>の
	<smbconfoption><name>obey pam restrictions</name></smbconfoption>の制限によって限定される。これが設定されると、以下の制限が適用される。
	</para>

	<itemizedlist>
	<listitem><para><emphasis>アカウントの妥当性確認</emphasis>:  Samba
	サーバに対するすべてのアクセスは、アカウントが妥当か、無効になっていないか、
	その時間にログインが許可されているかを PAM と照らし合わせて
	チェックされる。これは暗号化されたログインにも当てはまる。
	</para></listitem>

	<listitem><para><emphasis>セッション管理</emphasis>:  共有レベルのセキュリティ
	(訳注:smb.conf での security = share を指す)を使用していない場合、
	ユーザはアクセスが許可される前に PAM のセッションチェックをパスしなくてはいけない。
	一方、共有レベルのセキュリティではこれはスキップされることに注意。
	また、いくつかの古い pam 設定ファイルではセッションをサポートするために
	行の追加が必要かも知れないことにも注意。
	</para></listitem>
	</itemizedlist>
</refsect1>

<refsect1>
	<title>バージョン</title>

	<para>このマニュアルページは Samba スイートのバージョン
	3.0 用になっている。</para>
</refsect1>

<refsect1>
	<title>診断</title>

	<para>サーバによって出力されたほとんどの診断は、指定されたログファイルに
	記録される。ログファイルの名前はコンパイル時に指定されるが、
	コマンドラインで変更することもできる。</para>

	<para>利用できる診断の数と性質は、サーバで使用されるデバッグ・レベルに
	依存する。もし問題を抱えているなら、デバッグ・レベルを 
	3 に設定してログファイルに目を通すこと。</para>

	<para>ほとんどのメッセージは充分に自明であろう。あいにく、
	このマニュアルページ作成時にはあまりにもさまざまな診断メッセージが
	存在しているため、診断メッセージをすべて記述することを保証できない。
	そのような場合にもっともよい方法は、ソースコードを検索
	(grep)することであり、着目している診断メッセージを引き起こした条件を
	探すことである。</para>
</refsect1>

<refsect1>
	<title>シグナル</title>

	<para><command>smbd</command> に SIGHUP を送ることで、
	<filename>smb.conf</filename> の内容を短時間の内に
	再読み込みさせることができる。</para>

	<para><command>smbd</command> のプロセスをシャットダウンさせるのに、
	最後の手段として以外には <command>SIGKILL (-9)</command> は
	<emphasis>使わない</emphasis> ことを推奨する。共有メモリのエリアが不整合なままに
	なってしまうことがあるためである。<command>smbd</command>
	を安全に終了させる方法は、SIGTERM (-15) を送って、<command>smbd</command>
	自身が終了するのを待つことである。</para>

	<para><citerefentry><refentrytitle>smbcontrol</refentrytitle><manvolnum>1</manvolnum></citerefentry>
	を使うと <command>smbd</command> のデバッグ・ログ・レベルを上げたり下げたりできる
	(SIGUSR[1|2] シグナルは Samba 2.2 ではもはや使用されない)。
	これにより、低いログ・レベルで動作している間に発生する
	一時的な問題を診断することができる。</para>

	<para>デバッグ書き込みを送る <command>smbd</command> のシグナル・
	ハンドラは再入可能になっていない。ゆえにシグナルを発行するときは、
	<command>smbd</command> が SMB 待ちの状態になるまで待つ必要がある。
	select 呼び出しの前にシグナルのブロッキングを解除し、呼び出しの後で再び
	ブロッキングすればシグナル・ハンドラを安全にすることができるが、
	これはパフォーマンスに影響するだろう。</para>
</refsect1>

<refsect1>
	<title>関連項目</title>
	<para><citerefentry><refentrytitle>hosts_access</refentrytitle>
	<manvolnum>5</manvolnum></citerefentry>, <citerefentry><refentrytitle>inetd</refentrytitle>
	<manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>nmbd</refentrytitle>
	<manvolnum>8</manvolnum></citerefentry>, <citerefentry><refentrytitle>smb.conf</refentrytitle>
	<manvolnum>5</manvolnum></citerefentry>, <citerefentry><refentrytitle>smbclient</refentrytitle>
	<manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>testparm</refentrytitle>
	<manvolnum>1</manvolnum></citerefentry>, <citerefentry><refentrytitle>testprns</refentrytitle>
	<manvolnum>1</manvolnum></citerefentry>, and the 
	およびインターネット RFC の	<filename>rfc1001.txt</filename>, <filename>rfc1002.txt</filename>. 
	加えて CIFS(以前は SMB)の仕様は以下のWebページから入手できる:
	<ulink noescape="1" url="http://samba.org/cifs/"> http://samba.org/cifs/</ulink>.</para>
</refsect1>

<refsect1>
	<title>作者</title>
	
	<para>オリジナルの Samba ソフトウェアと関連するユーティリティは、
	Andrew Tridgell によって作られた。Samba は現在 Linux カーネルが
	開発されているような方法でのオープンソースプロジェクトである 
	Samba Team によって開発されている。</para>
	
	<para>オリジナルの Samba の マニュアルページは Karl Auer によって書かれた。
	マニュアルページは YODL 形式(別の、優秀なオープンソースソフトウェアで、 
	(<ulink url="ftp://ftp.icce.rug.nl/pub/unix/">ftp://ftp.icce.rug.nl/pub/unix/</ulink>にある)
	で変換され、Jeremy Allison によって Samba 2.0 リリースのために更新された。
	Samba 2.2 のための DocBook 形式への変換は Gerald Carter が行った。
	Samba 3.0 のための DocBook XML 4.2 形式への変換は Alexander Bokovoy が行った。
	</para>
</refsect1>

</refentry>

